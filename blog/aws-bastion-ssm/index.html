<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Black Arrow Gang"><meta name=description content="Leave the heavy lifting to us: DevOps, Cloud, and SRE solutions that simplify and optimize your operations."><meta name=keywords content="Best practices,High availability,Cloud network security,Secure remote access,Containerization,Multi-region deployments,Platform,Scalability,DevOps services,DevOps solutions,DevOps consulting,Continuous Integration,Continuous Deployment,Infrastructure as Code,Cloud-native applications,Cloud computing services,Serverless architecture,Microservices architecture,Cloud migration strategies,Disaster recovery"><meta itemprop=name content="Black Arrow Gang"><meta itemprop=description content="Leave the heavy lifting to us: DevOps, Cloud, and SRE solutions that simplify and optimize your operations."><meta property="og:title" content="Black Arrow Gang"><meta property="og:description" content="Leave the heavy lifting to us: DevOps, Cloud, and SRE solutions that simplify and optimize your operations."><meta property="og:type" content="website"><meta property="og:url" content="https://www.blackarrowgang.com/"><link rel=canonical href=https://www.blackarrowgang.com/><script async src="https://www.googletagmanager.com/gtag/js?id=G-GZLHVFY8EK"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GZLHVFY8EK",{anonymize_ip:!1})}</script><link rel=icon type=image/x-icon href=https://blackarrowgang.github.io/Landing/img/favicon-16x16.png><link rel=stylesheet href=https://blackarrowgang.github.io/Landing/css/styles.css><script src=https://blackarrowgang.github.io/Landing/js/script.js defer></script><title>Black Arrow Gang - DevOps Services</title></head><body><header id=header class=header><div class=logo><a href=https://blackarrowgang.github.io/Landing/><img src=https://blackarrowgang.github.io/Landing/img/dragon_icon.png alt="Dragon icon">
<span>Black Arrow Gang</span></a></div><div class=navigation><input type=checkbox class=toggle-menu><div class=hamburger></div><ul class=menu><li><a href=https://blackarrowgang.github.io/Landing/contact>Contact</a></li><li><a href=https://blackarrowgang.github.io/Landing/about>About Us</a></li><li><a href=https://blackarrowgang.github.io/Landing/blog>Blog</a></li></ul></div></header><link rel=stylesheet href=https://blackarrowgang.github.io/Landing/css/github-markdown.css><style>.markdown-body{box-sizing:border-box;margin:0 auto;min-width:200px;max-width:980px;padding:45px;background-color:#1b1c1d}@media(max-width:767px){.markdown-body{padding:15px}}ul{list-style:none;padding:10 0 0;margin:0}.space{padding:inherit}</style><div class=container><main><a href=https://blackarrowgang.github.io/Landing/>Go back</a><div class=markdown-body><h1 id=effortless-aws-bastion-setup><strong>Effortless AWS Bastion Setup</strong></h1><h2 id=description><strong>Description</strong></h2><p>This Terraform provisions the infrastructure for a fully managed bastion. The bastion serves as a secure entry point to access your resources within a Virtual Private Cloud (VPC). By leveraging SSM, you can establish a secure and controlled connection to your resources without the need for a public IP or opening inbound SSH ports.</p><h2 id=use-cases><strong>Use Cases</strong></h2><p>The Terraform bastion setup can be utilized in various scenarios, including:</p><ol><li><p><strong>Secure Remote Access</strong>: Provide a secure remote access solution by allowing authorized users to connect to AWS resources through the bastion host. Users can securely manage and administer resources without directly exposing them to the public internet.</p></li><li><p><strong>Bastion Alternative</strong>: Replace traditional bastion hosts with this setup. The bastion host acts as an intermediate access point, allowing a direct connection to resources located in private subnets based on ports.</p></li><li><p><strong>Enhanced Security</strong>: Restrict access to resources by leveraging security groups to control inbound and outbound traffic between the bastion host and other resources. This helps protect sensitive data and ensures that only authorized communication is allowed.</p></li></ol><h2 id=diagram><strong>Diagram</strong></h2><p><img src=https://raw.githubusercontent.com/BlackArrowGang/Arsenal/main/quiver/aws-bastion-ssm/diagrams/bastion-diagram.png alt="Bastion Diagram"></p><h2 id=how-it-works><strong>How It Works</strong></h2><h3 id=requirements><strong>Requirements</strong></h3><ul><li><a href=https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli>Terraform</a></li><li><a href=https://github.com/aws/aws-cli>AWS CLI</a></li><li><a href=https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html>Session Manager Plugin</a></li></ul><p><strong>For connection:</strong></p><ul><li>User with IAM policy ssm:StartSession</li><li>Set document/AWS-StartPortForwardingSessionToRemoteHost on the user&rsquo;s policy</li></ul><p>Steps:</p><ol><li><p>Run <code>terraform init</code> to install modules: This will install the necessary modules to initialize.</p></li><li><p>Run <code>terraform plan</code> to review changes in your actual AWS infrastructure <img src=https://raw.githubusercontent.com/BlackArrowGang/Arsenal/main/quiver/aws-bastion-ssm/diagrams/terraform_plan.svg alt="terraform plan command"></p></li><li><p>Change local variables if needed</p><p>Default variables:</p><pre tabindex=0><code>locals {
    aws_region      = &#34;us-east-2&#34;  # Specify the AWS region where the infrastructure will be deployed
    vpc_cidr_block  = &#34;142.32.0.0/16&#34;  # Define the CIDR block for the VPC
    ami_id          = &#34;ami-01107263728f3bef4&#34;  # Specify the ID of the AMI
    instance_type   = &#34;t2.micro&#34;  # Specify the type of the EC2 instance
    vpc_name        = &#34;BastionVPC&#34; # Provide a name for the VPC
    ec2_tag_name    = &#34;Bastion EC2&#34; # Specify a name tag for the EC2 instance
}
</code></pre></li><li><p>Run <code>terraform apply</code> to apply changes to infrastructure <img src=https://raw.githubusercontent.com/BlackArrowGang/Arsenal/main/quiver/aws-bastion-ssm/diagrams/terraform_apply.svg alt="terraform apply command"></p></li><li><p><strong>Apply the security group to the desired resource within the same VPC to enable a connection from the bastion to the resource.</strong>, <em>This Terraform code creates a security group that includes the necessary ports to establish a connection with a PostgreSQL RDS.</em></p></li><li><p>Apply the following IAM Policy on the AWS Console to the desired user profile in order to enable connection to the SSM:
<em>Replace the instance ID with the ID of the EC2 instance with the tag name &ldquo;Bastion EC2&rdquo;</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Sid&#34;</span>: <span style=color:#e6db74>&#34;AllowSSMStartSessionEC2&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;ssm:StartSession&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:ec2:us-east-2:*:instance/&lt;instance_id&gt;&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Sid&#34;</span>: <span style=color:#e6db74>&#34;AllowSSMUseDocument&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;ssm:StartSession&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:ssm:us-east-2:*:document/AWS-StartPortForwardingSession&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p><em>Command to obtain the bastion instance ID:</em>
<code>aws ec2 describe-instances --filters "Name=tag:Name,Values=Bastion EC2"</code></p></li></ol><h2 id=usage>Usage</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>    aws ssm start-session <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --target &lt;instance_id&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --document-name AWS-StartPortForwardingSessionToRemoteHost <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --parameters <span style=color:#e6db74>&#39;{&#34;host&#34;:[&#34;&lt;resource_endpoint|resource_ip&gt;&#34;], &#34;portNumber&#34;:[&#34;&lt;host_port&gt;&#34;], &#34;localPortNumber&#34;:[&#34;&lt;machine_port&gt;&#34;]}&#39;</span>
</span></span></code></pre></div><p>instance_id: The instance id of the EC2 you want to establish a session with (e.g. i-0123456789abcdef0)</p><p>portNumber: The port number on the remote resource which you want to forward traffic. (e.g. 80)</p><p>localPortNumber: The port number you want to use locally. (e.g. 5432)</p><h2 id=support>Support</h2><p>If you encounter any issues or have questions related to this AWS BASTION SSM setup with Terraform, or need assistance setting up the BASTION or any other related services, Hire us and we can do it for you.</p><p>To get started, you can visit our website <a href=https://blackarrowgang.com>blackarrowgang.com</a> to explore our services and schedule a meeting with our team. We are committed to providing you with the necessary support and guidance to ensure a successful implementation of your VPN infrastructure.</p><p>Dont forget to checkout our youtube channel <a href=https://www.youtube.com/@blackarrowgang3373>Black Arrow Gang</a>, where we will showcase the functionality of this services in the future.</p><p>And if you are feeling generous, you can go ahead and buy us a cup of coffee.</p><p><a href=https://blackarrowgang.com><img src=https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png alt="&amp;ldquo;Buy Me A Coffee&amp;rdquo;"></a></p></div></main><aside><div class="push aside-content"><div class=calendly-inline-widget data-url="https://calendly.com/d/z7q-zjf-v2r/initial-consultation-call?hide_event_type_details=1&hide_gdpr_banner=1&background_color=232425&text_color=eaeaea&primary_color=8fd694"><h2>Need help with this?</h2><h3>Let us handle your needs</h3></div><script type=text/javascript src=https://assets.calendly.com/assets/external/widget.js async></script></div></aside></div><footer><p>© Copyright 2023, BlackArrowGang. All Rights Reserved</p><span class=icons><a href=mailto:blackarrowgang001@gmail.com rel=noopener><img src=https://blackarrowgang.github.io/Landing/img/icon-email.png alt="email link icon"></a>
<a href=https://github.com/BlackArrowGang/Arsenal target=_blank rel=noopener><img src=https://blackarrowgang.github.io/Landing/img/icon-github.png alt="github link icon"></a>
<a href=https://youtube.com/@blackarrowgang3373 target=_blank rel=noopener><img src=https://blackarrowgang.github.io/Landing/img/icon-youtube.png alt="youtube link icon"></a></span></footer></body></html>