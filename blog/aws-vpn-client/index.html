<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Black Arrow Gang"><meta name=description content="Leave the heavy lifting to us: DevOps, Cloud, and SRE solutions that simplify and optimize your operations."><meta name=keywords content="Best practices,High availability,Cloud network security,Secure remote access,Containerization,Multi-region deployments,Platform,Scalability,DevOps services,DevOps solutions,DevOps consulting,Continuous Integration,Continuous Deployment,Infrastructure as Code,Cloud-native applications,Cloud computing services,Serverless architecture,Microservices architecture,Cloud migration strategies,Disaster recovery"><meta itemprop=name content="Black Arrow Gang"><meta itemprop=description content="Leave the heavy lifting to us: DevOps, Cloud, and SRE solutions that simplify and optimize your operations."><meta property="og:title" content="Black Arrow Gang"><meta property="og:description" content="Leave the heavy lifting to us: DevOps, Cloud, and SRE solutions that simplify and optimize your operations."><meta property="og:type" content="website"><meta property="og:url" content="https://www.blackarrowgang.com/"><link rel=canonical href=https://www.blackarrowgang.com/><script async src="https://www.googletagmanager.com/gtag/js?id=G-GZLHVFY8EK"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GZLHVFY8EK",{anonymize_ip:!1})}</script><link rel=icon type=image/x-icon href=https://blackarrowgang.github.io/Landing/img/favicon-16x16.png><link rel=stylesheet href=https://blackarrowgang.github.io/Landing/css/styles.css><script src=https://blackarrowgang.github.io/Landing/js/script.js defer></script><title>Black Arrow Gang - DevOps Services</title></head><body><header id=header class=header><div class=logo><a href=https://blackarrowgang.github.io/Landing/><img src=https://blackarrowgang.github.io/Landing/img/dragon_icon.png alt="Dragon icon">
<span>Black Arrow Gang</span></a></div><div class=navigation><input type=checkbox class=toggle-menu><div class=hamburger></div><ul class=menu><li><a href=https://blackarrowgang.github.io/Landing/contact>Contact</a></li><li><a href=https://blackarrowgang.github.io/Landing/about>About Us</a></li><li><a href=https://blackarrowgang.github.io/Landing/blog>Blog</a></li></ul></div></header><link rel=stylesheet href=https://blackarrowgang.github.io/Landing/css/github-markdown.css><style>.markdown-body{box-sizing:border-box;margin:0 auto;min-width:200px;max-width:980px;padding:45px;background-color:#1b1c1d}@media(max-width:767px){.markdown-body{padding:15px}}ul{list-style:none;padding:10 0 0;margin:0}.space{padding:inherit}</style><div class=container><main><div class=markdown-body><div class=route-navigation><ul><li><a href=https://blackarrowgang.github.io/Landing/>Home</a></li><li><span>></span></li><li><a href=https://blackarrowgang.github.io/Landing//blog>Blog</a></li><li><span>></span></li><li><span class=markdown-body-color>aws vpn client</span></li></ul></div><h1 id=simplify-remote-access-effective-aws-client-vpn-endpoint-setup><strong>Simplify Remote Access: Effective AWS Client VPN Endpoint Setup</strong></h1><p>üîí Connect remote users to AWS resources securely and seamlessly with AWS Client VPN Endpoint. Easily manage and configure it for easy access to sensitive data and applications. Enjoy a user-friendly experience. üíªüîê</p><h2 id=table-of-contents><strong>Table of contents</strong></h2><ul><li><a href=#use-cases>Use Cases</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#installation>Installation</a></li><li><a href=#usage>Usage</a></li><li><a href=#how-it-works>How It Works</a></li><li><a href=#support>Support</a></li></ul><p><img src=https://raw.githubusercontent.com/BlackArrowGang/Arsenal/main/quiver/aws-vpn-client/diagrams/vpn-diagram.png alt="VPN Diagram"></p><h2 id=use-cases><strong>Use Cases</strong></h2><p>The AWS VPN setup can be utilized in various scenarios, including:</p><ol><li><p><strong>Remote Access (Bastion Alternative)</strong>: Provide a secure alternative to a bastion by enabling authorized users to securely connect with high availability to AWS resources through a virtual private network (VPN) from remote locations.</p></li><li><p><strong>Site-to-Site Connectivity</strong>: Establish secure connections between multiple on-premises data centers or branch offices and the AWS cloud, enabling seamless and protected communication between these environments, including multi-region deployments.</p></li><li><p><strong>Third-Party Vendor Access</strong>: Many enterprises work with external vendors or consultants who require access to specific resources for collaboration or system integration. Cloud network security plays a vital role in this scenario. This VPN can provide a secure and controlled connection for these vendors to access the necessary resources without exposing the internal network to external threats.</p></li></ol><h2 id=requirements><strong>Requirements</strong></h2><table><thead><tr><th>Name</th><th>Version</th></tr></thead><tbody><tr><td><a href=https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli>Terraform</a></td><td>>= 1.0</td></tr><tr><td><a href=https://github.com/aws/aws-cli>AWS CLI</a></td><td>>= 2.0</td></tr><tr><td><a href=https://openvpn.net/community-downloads/>OpenVPN</a></td><td>>= 2.5</td></tr></tbody></table><h2 id=installation><strong>Installation</strong></h2><h3 id=install-a-openvpn-client>Install a OpenVPN client</h3><ul><li>Desktop version<ul><li>AWS Desktop client</li></ul></li><li>linux (Debian)<pre tabindex=0><code>sudo apt install openvpn
</code></pre></li></ul><hr><h3 id=download-module>Download Module</h3><p>Inside your terraform proyect, create a &ldquo;modules&rdquo; directory</p><pre tabindex=0><code>mkdir modules
</code></pre><p>Move into that directory</p><pre tabindex=0><code>cd modules
</code></pre><p>Clone the repository</p><pre tabindex=0><code>git clone https://github.com/BlackArrowGang/Arsenal.git
</code></pre><p>Go to the solution directory</p><pre tabindex=0><code>cd /Arsenal/quiver/aws-vpn-client
</code></pre><p>or just copy the folder directly into modules</p><pre tabindex=0><code>cd /modules/aws-vpn-client
</code></pre><h3 id=aws-vpn-certificates-setup>AWS VPN Certificates Setup</h3><ul><li>Refer to this AWS
documentation for detailed instructions on how to create and import the vpn certificates on your account.</li></ul><h2 id=usage><strong>Usage</strong></h2><p><strong>Example Code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>module</span> <span style=color:#e6db74>&#34;vpc&#34;</span> {
</span></span><span style=display:flex><span>  source  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;terraform-aws-modules/vpc/aws&#34;</span>
</span></span><span style=display:flex><span>  version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;5.0.0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Custom_VPC&#34;</span>
</span></span><span style=display:flex><span>  cidr <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;142.32.0.0/16&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  azs             <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;us-east-2a&#34;, &#34;us-east-2b&#34;</span>]
</span></span><span style=display:flex><span>  private_subnets <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;142.32.1.0/24&#34;, &#34;142.32.2.0/24&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>module</span> <span style=color:#e6db74>&#34;vpn&#34;</span> {
</span></span><span style=display:flex><span>    source <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;./modules/aws-vpn-client&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    resource_port <span style=color:#f92672>=</span> <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>    vpc_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>module</span>.<span style=color:#66d9ef>vpc</span>.<span style=color:#66d9ef>vpc_id</span>
</span></span><span style=display:flex><span>    vpc_cidr_block <span style=color:#f92672>=</span> <span style=color:#66d9ef>module</span>.<span style=color:#66d9ef>vpc</span>.<span style=color:#66d9ef>vpc_cidr_block</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    private_subnets <span style=color:#f92672>=</span> <span style=color:#66d9ef>module</span>.<span style=color:#66d9ef>vpc</span>.<span style=color:#66d9ef>private_subnets</span>
</span></span><span style=display:flex><span>    availability_zones <span style=color:#f92672>=</span> <span style=color:#66d9ef>module</span>.<span style=color:#66d9ef>vpc</span>.<span style=color:#66d9ef>azs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    vpn_cidr_block <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;192.168.128.0/22&#34;</span>
</span></span><span style=display:flex><span>    server_certificate <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&lt;REPLACE&gt;&#34;</span>
</span></span><span style=display:flex><span>    client_certificate <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&lt;REPLACE&gt;&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Terraform Setup</strong></p><ol><li>Open a terminal window.</li><li>Run the following commands.</li></ol><pre tabindex=0><code>terraform init
</code></pre><hr><pre tabindex=0><code>terraform plan
</code></pre><pre tabindex=0><code>terraform apply
</code></pre><p><strong>Configure Config File</strong></p><ul><li>Once the VPN module is applied, on the AWS Console dashboard go to the Client VPN Endpoint section inside the VPC service page, and download the client configuration file</li></ul><p><img src=https://raw.githubusercontent.com/BlackArrowGang/Arsenal/dev/quiver/aws-vpn-client/diagrams/image_01.png alt="Download client config file"></p><ul><li>Edit this file by adding the location of you client certificate and key at the end of the file<pre tabindex=0><code>cert &#34;C:\custom_folder\client1.domain.tld.crt&#34;
key &#34;C:\custom_folder\client1.domain.tld.key&#34;
</code></pre></li></ul><p><strong>Connect to VPN</strong></p><ul><li><p>Desktop Client</p><ul><li>Go to the section named &ldquo;Exporting and configuring the VPN client configuration file&rdquo; of this AWS documentation to connect with your vpn client.</li></ul></li><li><p>Linux Command</p><pre tabindex=0><code>sudo openvpn --config config.ovpn
</code></pre></li></ul><h2 id=how-it-works><strong>How It Works</strong></h2><ol><li><p>Local Variables:</p><ul><li>The code defines several local variables, including the AWS profile, region, resource port, VPC CIDR block, VPN CIDR block, availability zones, private subnets, server certificate, and client certificate.</li></ul></li><li><p>Provider Configuration</p><ul><li>The code specifies the AWS provider configuration using the local profile and region variables.</li></ul></li><li><p>Client VPN Configuration:</p><ul><li><p>The aws_ec2_client_vpn_endpoint resource creates the client VPN endpoint. It sets the description, server certificate ARN, client CIDR block, split tunneling, security group IDs, and VPC ID. It also configures certificate-based authentication and disables connection logging.</p></li><li><p>The aws_ec2_client_vpn_authorization_rule resource sets up an authorization rule for the client VPN endpoint. It authorizes all client VPN groups to access the VPC&rsquo;s target network CIDR block defined in the VPC module.</p></li><li><p>The aws_ec2_client_vpn_network_association resources associate the client VPN endpoint with the specified private subnets from the VPC module, allowing VPN clients to access resources in those subnets.</p></li></ul></li><li><p>Security Group Modules:</p><ul><li>The code includes two security group modules: &ldquo;vpn_access_sg&rdquo; and &ldquo;resource_access_sg.&rdquo; The &ldquo;vpn_access_sg&rdquo; module allows UDP traffic on port 443 from all IP ranges, while the &ldquo;resource_access_sg&rdquo; module allows all inbound and outbound traffic on the specified resource port within the VPC.</li></ul></li><li><p>VPC Module:</p><ul><li>The code uses the &ldquo;vpc&rdquo; module to create a custom VPC. It sets up the VPC with the specified name, CIDR block, availability zones, and private subnets. The VPC module creates the VPC, subnets, route tables, and other associated resources.</li></ul></li></ol><h2 id=support><strong>Support</strong></h2><p>If you encounter any issues or have questions related to this AWS VPN setup with Terraform, or need assistance setting up the VPN or any other related services, Hire us and we can do it for you.</p><p>To get started, you can visit our website <a href=https://blackarrowgang.com>blackarrowgang.com</a> to explore our services and schedule a meeting with our team. We are committed to providing you with the necessary support and guidance to ensure a successful implementation of your VPN infrastructure.</p><p>Dont forget to checkout our youtube channel <a href=https://www.youtube.com/@blackarrowgang3373>Black Arrow Gang</a>, where we will showcase the functionality of this services in the future.</p><p>And if you are feeling generous you can go ahead and buy us a cup a coffee.</p><p><a href=https://blackarrowgang.com><img src=https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png alt="&amp;ldquo;Buy Me A Coffee&amp;rdquo;"></a></p></div></main><aside class="sidebar push"><div class=centered-element><div class="calendly-inline-widget fixed" data-url="https://calendly.com/d/z7q-zjf-v2r/initial-consultation-call?hide_event_type_details=1&hide_gdpr_banner=1&background_color=232425&text_color=eaeaea&primary_color=8fd694"><h2>Need help with this?</h2><h3>Let us handle your needs</h3></div></div><script type=text/javascript src=https://assets.calendly.com/assets/external/widget.js async></script></aside></div><footer><p>¬© Copyright 2023, BlackArrowGang. All Rights Reserved</p><span class=icons><a href=mailto:blackarrowgang001@gmail.com rel=noopener><img src=https://blackarrowgang.github.io/Landing/img/icon-email.png alt="email link icon"></a>
<a href=https://github.com/BlackArrowGang/Arsenal target=_blank rel=noopener><img src=https://blackarrowgang.github.io/Landing/img/icon-github.png alt="github link icon"></a>
<a href=https://youtube.com/@blackarrowgang3373 target=_blank rel=noopener><img src=https://blackarrowgang.github.io/Landing/img/icon-youtube.png alt="youtube link icon"></a></span></footer></body></html>